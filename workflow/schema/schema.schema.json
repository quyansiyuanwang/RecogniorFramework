{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Recognior Workflow Schema",
  "type": "object",
  "properties": {
    "begin": {
      "type": "string",
      "description": "流程起始节点名称，必须是 jobs 中的一个 key"
    },
    "globals": {
      "type": "object",
      "description": "全局配置",
      "properties": {
        "debug": { "type": "boolean", "description": "是否开启调试模式" }
      },
      "additionalProperties": true
    },
    "jobs": {
      "type": "object",
      "description": "所有任务节点定义",
      "patternProperties": {
        ".*": {
          "type": "object",
          "properties": {
            "type": {
              "type": "string",
              "enum": ["ROI", "OCR", "Input", "System"],
              "description": "任务类型"
            },
            "description": { "type": "string", "description": "任务描述" },
            "needs": {
              "type": "array",
              "items": { "type": "string" },
              "description": "依赖的前置任务名"
            },
            "image": {
              "type": "object",
              "properties": {
                "path": { "type": "string", "description": "图片路径" },
                "confidence": { "type": "number", "minimum": 0, "maximum": 1, "description": "置信度" }
              },
              "required": ["path"],
              "additionalProperties": true
            },
            "action": {
              "type": "object",
              "properties": {
                "type": { "type": "string", "description": "动作类型，如 LClick、KeyboardInput、TextInput" },
                "keys": {
                  "type": "array",
                  "items": { "type": "string" },
                  "description": "键盘输入的按键列表"
                },
                "text": { "type": "string", "description": "要输入的文本" },
                "position": {
                  "type": "object",
                  "properties": {
                    "type": { "type": "string", "enum": ["Relative", "Absolute"], "description": "坐标类型" },
                    "x": { "type": "number", "description": "X 坐标" },
                    "y": { "type": "number", "description": "Y 坐标" }
                  },
                  "required": ["type"],
                  "additionalProperties": true
                }
              },
              "required": ["type"],
              "additionalProperties": true
            },
            "region": {
              "type": "object",
              "properties": {
                "x": { "type": "number", "description": "区域左上角 X 坐标" },
                "y": { "type": "number", "description": "区域左上角 Y 坐标" },
                "width": { "type": "number", "description": "区域宽度" },
                "height": { "type": "number", "description": "区域高度" }
              },
              "required": ["x", "y", "width", "height"],
              "additionalProperties": true
            },
            "next": {
              "oneOf": [
                { "type": "string", "description": "下一个任务名" },
                {
                  "type": "object",
                  "properties": {
                    "success": { "type": "string", "description": "成功时的下一个任务名" },
                    "failure": { "type": "string", "description": "失败时的下一个任务名" }
                  },
                  "additionalProperties": false
                }
              ],
              "description": "下一个任务名或分支"
            },
            "delay": {
              "type": "object",
              "properties": {
                "pre": { "type": "number", "description": "前置延时，毫秒" },
                "cur": { "type": "number", "description": "当前延时，毫秒" },
                "post": { "type": "number", "description": "后置延时，毫秒" }
              },
              "additionalProperties": true
            },
            "confidence": { "type": "number", "minimum": 0, "maximum": 1, "description": "置信度（OCR/ROI专用）" },
            "ret": { "type": "string", "description": "返回值类型" },
            "maxTries": { "type": "integer", "minimum": 1, "description": "最大重试次数" }
          },
          "required": ["type", "description"],
          "additionalProperties": true
        }
      }
    }
  },
  "required": ["begin", "jobs"],
  "additionalProperties": false
}
